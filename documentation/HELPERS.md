## Detalle de funciones de soporte (helpers)

### ./helpers/absence\_helper.rb

| FUNCIÓN                         | PARÁMETROS                                               | RESPUESTA | DETALLES                                                                  |
|---------------------------------|----------------------------------------------------------|-----------|---------------------------------------------------------------------------|
| employee\_absence\_contains\_dates | employee\_absence&nbsp;(EmployeeAbsence)<br>dates (Date Array) | Bool      | Chequea si la ausencia del empleado incluye alguna de las fechas buscadas |

### ./helpers/action\_log\_helper.rb

| FUNCIÓN                         | PARÁMETROS                                              | RESPUESTA | DETALLES                                                                                                                                           |
|---------------------------------|---------------------------------------------------------|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| action\_log\_for\_employee\_absence | employee\_absence&nbsp;(EmployeeAbsence)<br>message (String) | ActionLog | Genera y retorna una entrada en el registro de acciones para una ausencia de empleado                                                              |
| action\_log\_for\_absence          | absence (ShiftAbsence)<br>message (String)             | ActionLog | Genera y retorna una entrada en el registro de acciones para una ausencia de turno                                                                 |
| action\_log\_for\_shift            | shift (Shift)<br>message (String)                      | ActionLog | Genera y retorna una entrada en el registro de acciones para un turno de trabajo                                                                   |
| action\_log\_for\_location         | location (Location)<br>message (String)                | ActionLog | Genera y retorna una entrada en el registro de acciones para una estación de trabajo                                                               |
| action\_log\_for\_employee         | employee (Employee)<br>message (String)                | ActionLog | Genera y retorna una entrada en el registro de acciones para un empleado                                                                           |
| action\_log\_for\_client           | client (Client)<br>message (String)                    | ActionLog | Genera y retorna una entrada en el registro de acciones para un cliente                                                                            |
| action\_log\_simple               | message (String)<br>details (String, opcional)         | ActionLog | Genera y retorna una entrada en el registro de acciones sin asociaciones, el campo details se puede completar para agregar información manualmente |

### ./helpers/alert\_helper.rb

| FUNCIÓN                                    | PARÁMETROS          | RESPUESTA | DETALLES                                                                                                                            |
|--------------------------------------------|---------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------|
| check_alert_2shifts_jointed                | employee&nbsp;(Employee) | Bool      | Revisa si un empleado tiene asignados dos turnos a la misma hora, devuelve `true` si se generó una alerta                           |
| check_availability_hours_with_shifts       | employee (Employee) | Bool      | Revisa si un empleado tiene asignado un turno fuera de su disponibilidad, devuelve `true` si se generó una alerta                   |
| check_availability_hours_with_replacements | employee (Employee) | Bool      | Revisa si un empleado tiene asignado una suplencia que fuera de su disponibilidad, devuelve `true` si se generó una alerta          |
| check_alert_too_many_hours                 | employee (Employee) | Bool      | Revisa si un empleado tiene asignadas más horas de las que puede trabajar por semana, devuelve `true` si se generó una alerta       |
| check_alert_empty_shift                    | shift (Shift)       | Bool      | Revisa si el turno está sin asignar, devuelve `true` si se generó una alerta                                                        |
| check_alert_location_with_missing_backups  | location (Location) | Bool      | Revisa si la estación posee algún pedido de refuerzo sin asignar, devuelve `true` si se generó una alerta                           |
| check_alert_invalid_type                   | shift (Shift)       | Bool      | Revisa si el turno está asignado a un empleado con tipo de trabajo diferente al necesario, devuelve `true` si se generó una alerta  |
| check_alert_needs_replacement              | shift (Shift)       | Bool      | Revisa si el turno tiene ausencias futuras sin suplir, devuelve `true` si se generó una alerta                                      |
| check_alert_contract_needs_atention        | location (Location) | Bool      | Revisa si el contrato de la estación no se cumple, devuelve `true` si se generó una alerta                                          |
| rescan_all_alerts                          |                     | nil       | Recorre todos los empleados, turnos y estaciones y realiza un chequeo de alertas en cada uno                                        |

### ./helpers/application\_helper.rb

| FUNCIÓN               | PARÁMETROS                                                                    | RESPUESTA       | DETALLES                                                                                                                            |
|-----------------------|-------------------------------------------------------------------------------|-----------------|-------------------------------------------------------------------------------------------------------------------------------------|
| user_matches_type     | type (Symbol)                                                                 | Bool            | Revisa si el usuario logueado posee un permiso en particular (ej. :absence_new)                                                     |
| menu_elements         |                                                                               | Array           | Devuelve un array de objetos con el cual se arma el menú de la izquierda y los íconos del homepage                                  |
| time_difference       | time_start&nbsp;(String&nbsp;/&nbsp;Sequel::SQLTime)<br>time_end (String / Sequel::SQLTime) | Float           | Devuelve la diferencia de tiempo entre 2 horarios, en caso de pasarle un fin anterior al inicio, asume que termina el día siguiente |
| seconds_to_time       | seconds (Integer)                                                             | Sequel::SQLTime | Convierte segundos a horas y minutos (ej. 4500 -> 1:15)                                                                             |
| validate_cuit         | cuit (String)                                                                 | Bool            | Valida si un CUIT es válido                                                                                                         |
| build_success_url     | url (String)<br>redir_url (String, opcional)                                 | String          | Devuelve una URL u otra, según si la URL de redirección que llega por parámetros está presente y es válida                          |
| build_error_url       | url (String)<br>params (Hash, deprecada)<br> errors (Hash)                   | String          | Arma una URL mezclando los parámetros, mensajes de error generados y la URL destino, se utiliza en formularios                      |
| initialize_work_hours |                                                                               | nil             | Recorre todos los turnos y empleados, inicializando sus horas de trabajo                                                            |

### ./helpers/client\_helper.rb

| FUNCIÓN              | PARÁMETROS                               | RESPUESTA    | DETALLES                                                                                                |
|----------------------|------------------------------------------|--------------|---------------------------------------------------------------------------------------------------------|
| client_import_fields |                                          | Hash         | Devuelve un mapa (key/value) con cada campo que puede importarse o exportarse de clientes               |
| client_extra_fields  |                                          | Hash         | Devuelve un mapa (key/value) con campos especiales que pueden exportarse de clientes (custom export)    |
| client_filters       | clients&nbsp;(Client&nbsp;Array)<br> params (Hash) | Client&nbsp;Array | Filtra un array de clientes según los campos del array de parámetros (ej, nombre, inicial, ciudad, etc) |
| client_setup         | client (Client)<br> params (Hash)        | Client       | Cambia los parámetros del cliente para que sean iguales a los parámetros recibidos por POST/GET         |

### ./helpers/control\_panel\_helper.rb

| FUNCIÓN                      | PARÁMETROS               | RESPUESTA | DETALLES                                                                                                  |
|------------------------------|--------------------------|-----------|-----------------------------------------------------------------------------------------------------------|
| em_role_privileges_to_list   | privileges&nbsp;(JSON&nbsp;String) | String    | Convierte un JSON string de permisos a un String de texto con el texto descriptivo de cada permiso activo |
| em_role_privileges_to_params | privileges (JSON String) | Hash      | Convierte un JSON string de permisos a un Hash de tipo params (GET/POST)                                  |
| em_role_privileges_to_hash   | privileges (JSON String) | Hash      | Convierte un JSON string de permisos a un Hash                                                            |
| available_privileges         |                          | Hash      | Lista todos los privilegios que pueden otorgarse y un texto descriptivo para cada uno                     |

### ./helpers/document\_helper.rb

| FUNCIÓN                         | PARÁMETROS                                    | RESPUESTA | DETALLES                                                                                      |
|---------------------------------|-----------------------------------------------|-----------|-----------------------------------------------------------------------------------------------|
| document_types                  |                                               | Hash      | Lista los tipos de documento que pueden crearse (empleado, cliente, general)                  |
| em_document_selectors           | text (String)<br>type (String)               | String    | Cambia los campos de texto de un documento por selectores usando `em_document_selector`       |
| em_document_markdown            | text (String)                                 | String    | Procesa usando Markdown el texto entrante para agregar negrita, cursiva y otros efectos       |
| em_document_selector            | type (String)<br>selected&nbsp;(Symbol,&nbsp;opcional) | String    | Convierte etiquetas XXXXXXXX en un selector según el tipo de documento que se está generando  |
| em_document_clickables_employee | text (String)<br>employee (Employee)         | String    | Convierte campos de tipo XXXXXXXX en elementos "clickeables" para completar antes de imprimir |

### ./helpers/employee\_helper.rb

| FUNCIÓN                                    | PARÁMETROS                                                                     | RESPUESTA      | DETALLES                                                                                                                                                                                                                   |
|--------------------------------------------|--------------------------------------------------------------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| employee_import_fields                     |                                                                                | Hash           | Devuelve un mapa (clave - valor) de todos los campos que pueden importarse o exportarse en empleados y su descripción                                                                                                      |
| employee_extra_fields                      |                                                                                | Hash           | Devuelve un mapa (clave - valor) de campos adicionales que pueden exportarse (custom export)                                                                                                                               |
| employee_default_available_hours           | employee (Employee)                                                            | Hash           | Devuelve un hash de horas de disponibilidad para un empleado, permitiendo trabajos de lunes a viernes, 7 a 19 hs                                                                                                           |
| employee_assigned_hours                    | employee (Employee)                                                            | Float          | Devuelve un número indicando el total de horas de trabajo semanales asignadas a este empleado                                                                                                                              |
| employee_setup                             | employee (Employee)<br>params (Hash)                                           | Employee       | Convierte el empleado que recibe para que todos los parámetros coincidan con los params recibidos (GET/POST)                                                                                                               |
| employee_filters                           | employees (Employee Array)<br>params (Hash)                                    | Employee&nbsp;Array | Filtra un array de empleados según los filtros deseados (ej. nombre, inicial, ciudad)                                                                                                                                      |
| get_current_employee_available_hours       | employee (Employee)<br>ignore_shift (Shift, opcional)                          | Hash           | Devuelve las horas de disponibilidad del empleado, restando turnos asignados, se puede ignorar uno de los turnos si se envía por parámetro                                                                                 |
| employee_availability_matches_shift        | employee (Employee)<br>shift (Shift)<br>single_day&nbsp;(Symbol&nbsp;,&nbsp;opcional) | Bool           | Revisa si el la disponibilidad del empleado coincide con las horas que requiere el turno, opcionalmente se puede comparar sólo 1 día (suplencias)                                                                          |
| available_employees_for_shift              | shift (Shift)<br>employees (Employee Array, opcional)                          | Employee Array | Devuelve una lista de empleados activos que puedan tomar un turno en particular según disponibilidad horaria, máximo de horas que puede trabajar, si acepta (o no) trabajar en feriados, tipo de trabajo buscado           |
| employee_availability_matches_shift_backup | employee (Employee)<br>shift_backup (ShiftBackup)                              | Bool           | Revisa si el la disponibilidad del empleado coincide con las horas que requiere el pedido de refuerzo                                                                                                                      |
| available_employees_for_shift_backup       | shift_backup (ShiftBackup)<br>employees (Employee Array, opcional)             | Employee Array | Devuelve una lista de empleados activos que puedan cubrir un pedido de refuerzo según disponibilidad horaria, máximo de horas que puede trabajar, si acepta (o no) trabajar en feriados, tipo de trabajo buscado           |
| available_employees_for_absences           | shift_absences (ShiftAbsence Array)<br>employees (Employee Array, opcional)    | Employee Array | Devuelve una lista de empleados activos que puedan cubrir la lista de ausencias recibida, según disponibilidad horaria, máximo de horas que puede trabajar, si acepta (o no) trabajar en feriados, tipo de trabajo buscado |

### ./helpers/export\_helper.rb

| FUNCIÓN                    | PARÁMETROS                                               | RESPUESTA    | DETALLES                                                                                                                      |
|----------------------------|----------------------------------------------------------|--------------|-------------------------------------------------------------------------------------------------------------------------------|
| export_client_row_titles   |                                                          | String&nbsp;Array | Devuelve el array de títulos al exportar clientes (custom)                                                                    |
| export_employee_row_titles |                                                          | String Array | Devuelve el array de títulos al exportar empleados (custom)                                                                   |
| export_client_row          | client (Client)                                          | String Array | Devuelve un array de datos para el cliente, según los datos a exportar (custom)                                               |
| export_employee_row        | employee (Employee)                                      | String Array | Devuelve un array de datos para el empleado, según los datos a exportar (custom)                                              |
| export_client_row_location | location (Location)                                      | String Array | Devuelve un array de datos para la estación de trabajo, según los datos a exportar (custom)                                   |
| export_client_row_shift    | shift (Shift)                                            | String Array | Devuelve un array de datos para el turno de trabajo, según los datos a exportar en clientes (custom)                          |
| export_employee_row_shift  | shift (Shift)                                            | String Array | Devuelve un array de datos para el turno de trabajo, según los datos a exportar en empleados (custom)                         |
| export_client_extras       | location (Location, opcional)<br>shift (Shift, opcional) | String Array | Devuelve un array de datos para los campos extra de clientes considerando una estación y turno de trabajo, o ninguno (custom) |
| export_employee_extras     | employee (Employee)<br>shift&nbsp;(Shift,&nbsp;opcional) | String Array | Devuelve un array de datos para los campos extra de empleados considerando un turno de trabajo, o ninguno (custom)            |

### ./helpers/location\_helper.rb

| FUNCIÓN                | PARÁMETROS                                                                   | RESPUESTA      | DETALLES                                                                                                     |
|------------------------|------------------------------------------------------------------------------|----------------|--------------------------------------------------------------------------------------------------------------|
| location_import_fields |                                                                              | Hash           | Devuelve un mapa (clave - valor) de los campos que pueden exportarse o importarse de una estación de trabajo |
| location_filters       | locations (Location Array)<br>params (Hash)                                  | Location&nbsp;Array | Devuelve un array filtrado de estaciones de trabajo según los parámetros de filtro (nombre, ciudad, etc)  |
| location_setup         | location (Location)<br>params (Hash)<br>parent_location&nbsp;(Location,&nbsp;opcional) | Location       | Devuelve la estación modificada para matchear con los parámetros enviados por GET/POST               |

### ./helpers/shift\_backup\_helper.rb

| FUNCIÓN                              | PARÁMETROS                                                                       | RESPUESTA   | DETALLES                                                                                         |
|--------------------------------------|----------------------------------------------------------------------------------|-------------|--------------------------------------------------------------------------------------------------|
| shift_backup_setup                   | shift_backup (ShiftBackup)<br>params(Hash)                                       | ShiftBackup | Devuelve el pedido de refuerzo modificado para matchear con los parámetros enviados por GET/POST |
| get_shift_backup_work_hours          | shift_backup (ShiftBackup)<br>params(Hash)                                           | ShiftBackupWorkHours | Devuelve las horas de trabajo para cubrir el refuerzo indicado                                   |
| get_day_from_shift_backup_work_hours | day (Date)<br>sb_work_hours&nbsp;(ShiftBackupWorkHours)<br>shift_backup (ShiftBackup) | Hash        | Función utilitaria, usada por `get_shift_backup_work_hours` para acumular las horas de cada día  |

### ./helpers/shift\_helper.rb

| FUNCIÓN              | PARÁMETROS                                                                           | RESPUESTA      | DETALLES                                                                                                                                                         |
|----------------------|--------------------------------------------------------------------------------------|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| shift_import_fields  |                                                                                      | Hash           | Devuelve un mapa (clave - valor) con los campos que pueden importarse o exportarse de turnos de trabajo y su descripción                                         |
| archive_shift        | shift (Shift)<br>create_new_shift (Bool, opcional)                                   | Shift          | Archiva un turno de trabajo y (opcionalmente) crea otro igual comenzando el día de cierre del anterior                                                           |
| shift_work_amount_at | start_time (Sequel::SQLTime)<br>end_time&nbsp;(Sequel::SQLTime)<br>current_hour (Integer) | Float          | Revisa cuánto tiempo de trabajo se necesita para un turno que comienza en `start_time` y termina en `end_time` para una hora en particular                       |
| shift_setup          | shift (Shift)<br>params (Hash)                                                       | Shift          | Modifica el turno recibido para que tenga los valores enviados vía params (GET/POST)                                                                             |
| get_shift_work_hours | shift (Shift)<br>params(Hash)                                                        | ShiftWorkHours | Devuelve la lista de horas necesarias cada día para el turno recibido                                                                                            |
| shift_matching_dates | shift (Shift)<br>start_date (Date)<br>end_date (Date)                                | Date&nbsp;Array     | Devuelve un array de fechas que coinciden con los días de trabajo de un turno en particular, usado para cargar ausencias de turno desde una ausencia de empleado |
| shift_work_hours     | day (Date)<br>shift_work_hours&nbsp;(ShiftWorkHours)<br>shift (Shift)                     | Hash           | Función utilitaria, usada por `get_shift_work_hours` para acumular las horas de cada día                                                                         |

### ./helpers/view\_helper.rb

| FUNCIÓN                      | PARÁMETROS                                                                                                  | RESPUESTA  | DETALLES                                                                                                                       |
|------------------------------|-------------------------------------------------------------------------------------------------------------|------------|--------------------------------------------------------------------------------------------------------------------------------|
| link_employee                | employee_id (Integer)                                                                                       | String     | Devuelve un string que incluye el nombre y enlace a un empleado                                                                |
| link_location                | location_id (Integer)                                                                                       | String     | Devuelve un string que incluye el nombre y enlace a una estación de trabajo                                                    |
| link_client                  | client_id (Integer)                                                                                         | String     | Devuelve un string que incluye el nombre y enlace a un cliente                                                                 |
| link_user                    | user_id (Integer)                                                                                           | String     | Devuelve un string que incluye el nombre y enlace a un usuario del sistema                                                     |
| build_query_string           | ignore_params (Hash, opcional)                                                                              | String     | Devuelve un query_string manteniendo los parámetros actuales e ignorando el parámetro que se necesite (usado para le paginado) |
| em_user_avatar               | id (Integer)                                                                                                | String     | Devuelve la ruta al avatar de un usuario o el ícono por defecto                                                                |
| em_client_logo               | id (Integer)                                                                                                | String     | Devuelve la ruta al logo de un cliente o el ícono por defecto                                                                  |
| em_file_input                | name (String)<br>pretty_name&nbsp;(String)<br>valid_types&nbsp;(String,&nbsp;opcional)<br>optional (Bool, opcional)         | String     | Devuelve un div, label e input necesarios para mostrar un campo de carga de archivos, procesa errores de formulario            |
| em_input                     | type (String)<br>name (String)<br>pretty_name (String)<br>placeholder (String)<br>optional (Bool, opcional) | String     | Devuelve un div, label e input necesarios para mostrar un campo de texto, procesa errores de formulario                        |
| em_checkbox                  | name (String)<br>label (String)<br>optional (Bool, opcional)                                                | String     | Devuelve un div, label e input necesarios para mostrar un checkbox cuadrado, procesa errores de formulario                     |
| em_radio                     | name (String)<br>value (String)<br>label (String)<br>optional (Bool, opcional)                              | String     | Devuelve un div, label e input necesarios para mostrar un checkbox redondo, procesa errores de formulario                      |
| em_select                    | name (String)<br>label (String)<br>list (String Array)<br>optional (Bool, opcional)                         | String     | Devuelve un div, label, select e options necesarios para mostrar un selector, procesa errores de formulario                    |
| em_provincias                | name (String)<br>label (String)                                                                             | String     | Uso particular de em_select con las provincias de Argentina                                                                    |
| em_countries                 | name (String)<br>label (String)                                                                             | String     | Uso particular de em_select con países (por ahora sólo Argentina)                                                              |
| em_pagination                | url_prefix (String)<br>current_page (Integer), page_count (Integer), page_delta (Integer)                   | String     | Devuelve un paginado con botones anterior, siguiente y mostrando al menos `page_delta` páginas extra a cada lado del actual    |
| em_pagination_page           | url_prefix (String)<br>page (Integer)<br>current_page (Integer)                                             | String     | Función utilitaria para `em_pagination`, genera el enlace a cada página decidiendo qué clases usar                             |
| location_breadcrumbs         | location (Location)<br>current_url (String, opcional)                                                       | Hash&nbsp;Array | Devuelve la lista de breadcrumbs anteriores a la location deseada (agrega los parents)                                         |
| human_readable_date          | date (Date)<br>start_time&nbsp;(Sequel::SQLTime, opcional)<br>end_time (Sequel::SQLTime, opcional)               | String     | Devuelve una fecha en formato detalle, opcionalmente indicando desde, hasta (ej. Lunes 3 de Febrero de 13:00 a 18:00)          |
| shift_holiday_label          | shift (Shift)                                                                                               | String     | Devuelve un texto indicando si se trabajan feriados o no                                                                       |
| shift_readable_dates         | shift (Shift)                                                                                               | String     | Devuelve las fechas de trabajo del turno en formato detalle (ej. Lunes, Jueves y Sábados de 13:00 a 18:00)                     |
| employee_shift_details       | employee (Employee)                                                                                         | String     | Devuelve el detalle de turnos de un empleado (para detalle en vista de versus)                                                 |
| date_to_week_day             | date (Date)                                                                                                 | Symbol     | Devuelve el símbolo del día de la semana para una fecha (ej. 2019-09-13 -> :friday)                                            |
| date_to_dayname              | date (Date)                                                                                                 | String     | Devuelve el nombre del día de la semana para una fecha (ej. 2019-09-13 -> 'Viernes')                                           |
| date_symbol_to_name          | sym_date (Symbol)                                                                                           | String     | Convierte un símbolo de día a un nombre de día (ej. :friday -> 'Viernes')                                                      |
| date_day_name_to_symbol      | day_name (String)                                                                                           | Symbol     | Convierte un nombre de día a un símbolo de día (ej. 'Viernes' -> :friday)                                                      |
| date_to_monthname            | date (Date)                                                                                                 | String     | Devuelve el nombre de mes de la fecha indicada (ej. 2019-09-13 -> 'Septiembre')                                                |
| holiday_calendar             | holidays (Holiday Array)<br>year (Integer)<br>month (Integer)                                               | String     | Genera el calendario HTML de feriados de un mes y año en particular, marcando los feriados como clickeables                    |
| employee_calendar            | employee (Employee)<br>year (Integer)<br>month (Integer)                                                    | String     | Genera el calendario HTML de empleados de un mes y año en particular, marcando los días trabajados, ausentes, y otros          |
| calendar_tooltip_shift       | shift (Shift)                                                                                               | String     | Devuelve el texto de tooltip para un turno en el calendario de empleados                                                       |
| calendar_tooltip_absence     | absence (ShiftAbsence)                                                                                      | String     | Devuelve el texto de tooltip para una ausencia de turno en el calendario de empleados                                          |
| calendar_tooltip_replacement | replacement (ShiftReplacement)                                                                              | String     | Devuelve el texto de tooltip para una suplencia de turno en el calendario de empleados                                         |
| calendar_tooltip_unavailable | employee_absence (EmployeeAbsence)                                                                          | String     | Devuelve el texto de tooltip para una ausencia de empleado en el calendario de empleados                                       |
| calendar_tooltip_holiday     | holiday (Holiday)<br>workday (Bool, opcional)                                                               | String     | Devuelve el texto de tooltip para un feriado (según si es o no laborable) en el calendario de empleados                        |
| calendar_color_and_tooltip   | employee (Employee)<br>current_day (Date)<br>holidays (Holiday Array)                                       | String     | Arma el tooltip y pinta una fecha en particular del calendario usando funciones helpers (`calendar_tooltip_*`)                 |
| calendar_reference           |                                                                                                             | String     | Devuelve la referencia de colores para el calendario de empleados                                                              |
| date_is_holiday              | date (Date)                                                                                                 | Bool       | Devuelve true o false, según si el día es un feriado                                                                           |
| trim                         | num (Numeric)                                                                                               | Numeric    | Redondea números para que no muestren decimales cuando no es necesario (ej. 15.0 -> 15 y 15.1 -> 15.1)                         |

